<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sydney's Class Schedule</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #fef7f0; color: #2d2d2d; min-height: 100vh; }
.container { max-width: 600px; margin: 0 auto; padding: 16px; }
h1 { font-size: 1.6rem; text-align: center; padding: 20px 0 8px; }
.subtitle { text-align: center; color: #888; font-size: 0.85rem; margin-bottom: 24px; }

.day-group { margin-bottom: 24px; }
.day-label { font-weight: 700; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: #e8829a; margin-bottom: 10px; padding-left: 4px; }

.card { background: #fff; border-radius: 16px; padding: 16px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); position: relative; }
.card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
.class-type { font-weight: 700; font-size: 1.05rem; }
.class-time { font-size: 0.95rem; color: #e8829a; font-weight: 600; }
.card-details { font-size: 0.82rem; color: #777; line-height: 1.6; }
.card-details span { margin-right: 12px; }
.card-actions { position: absolute; top: 12px; right: 12px; display: flex; gap: 6px; }
.btn-icon { background: none; border: none; cursor: pointer; font-size: 1rem; padding: 4px 8px; opacity: 0.5; transition: opacity 0.2s; border-radius: 6px; }
.btn-icon:hover { opacity: 1; background: #f5f5f5; }
.btn-delete:hover { color: #e74c3c; }

.add-btn { display: block; width: 100%; padding: 16px; border: 2px dashed #ddd; border-radius: 16px; background: none; color: #aaa; font-size: 1rem; cursor: pointer; transition: all 0.2s; margin-top: 8px; }
.add-btn:hover { border-color: #e8829a; color: #e8829a; }

/* Modal */
.modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 100; align-items: flex-end; justify-content: center; }
.modal-overlay.active { display: flex; }
.modal { background: #fff; border-radius: 24px 24px 0 0; width: 100%; max-width: 600px; padding: 24px; max-height: 90vh; overflow-y: auto; }
.modal h2 { font-size: 1.2rem; margin-bottom: 20px; text-align: center; }
.form-group { margin-bottom: 16px; }
.form-group label { display: block; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 6px; }
.form-group input, .form-group select { width: 100%; padding: 14px; border: 1.5px solid #e5e5e5; border-radius: 12px; font-size: 1rem; background: #fafafa; }
.form-group input:focus, .form-group select:focus { outline: none; border-color: #e8829a; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.btn-row { display: flex; gap: 12px; margin-top: 24px; }
.btn { flex: 1; padding: 16px; border: none; border-radius: 14px; font-size: 1rem; font-weight: 600; cursor: pointer; }
.btn-primary { background: #e8829a; color: #fff; }
.btn-secondary { background: #f0f0f0; color: #666; }

.toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: #2d2d2d; color: #fff; padding: 14px 28px; border-radius: 12px; font-size: 0.95rem; opacity: 0; transition: opacity 0.3s; z-index: 200; }
.toast.show { opacity: 1; }
.empty { text-align: center; padding: 60px 20px; color: #bbb; }
.loading { text-align: center; padding: 40px; color: #888; }
</style>
</head>
<body>
<div class="container">
  <h1>üèãÔ∏è‚Äç‚ôÄÔ∏è My Class Schedule</h1>
  <p class="subtitle">Auto-booking settings</p>
  <div id="schedule"><p class="loading">Loading...</p></div>
  <button class="add-btn" onclick="openModal()">+ Add Class</button>
</div>

<div class="modal-overlay" id="modal" onclick="event.target===this&&closeModal()">
  <div class="modal">
    <h2 id="modal-title">Add Class</h2>
    <div class="form-row">
      <div class="form-group">
        <label>Day</label>
        <select id="f-day">
          <option value="0">Sunday</option>
          <option value="1">Monday</option>
          <option value="2">Tuesday</option>
          <option value="3">Wednesday</option>
          <option value="4">Thursday</option>
          <option value="5">Friday</option>
          <option value="6">Saturday</option>
        </select>
      </div>
      <div class="form-group">
        <label>Time</label>
        <input type="time" id="f-time" value="09:00">
      </div>
    </div>
    <div class="form-group">
      <label>Class Type</label>
      <select id="f-class">
        <option>SCULPT</option>
        <option>STRENGTH + SWEAT</option>
        <option>SWEAT LAB</option>
        <option>DRENCHED</option>
        <option>RIDE</option>
        <option>RESTORE</option>
      </select>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Location</label>
        <select id="f-location">
          <option value="fusion-fitness">Fusion Fitness</option>
          <option value="sweat-lab">Sweat Lab</option>
        </select>
      </div>
      <div class="form-group">
        <label>Instructor (optional)</label>
        <input type="text" id="f-instructor" placeholder="e.g. Erica">
      </div>
    </div>
    <div class="form-group">
      <label>Preferred Spots (comma-separated)</label>
      <input type="text" id="f-spots" placeholder="e.g. 18, 8, 9">
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveEntry()">Save</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const DAYS = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
let config = { schedules: [], locations: {} };
let editIndex = -1;

async function load() {
  try {
    const r = await fetch('/api/settings');
    config = await r.json();
    render();
  } catch(e) { 
    document.getElementById('schedule').innerHTML = '<p class="empty">Failed to load schedule</p>'; 
  }
}

function render() {
  const el = document.getElementById('schedule');
  if (!config.schedules || !config.schedules.length) { 
    el.innerHTML = '<p class="empty">No classes scheduled yet.<br>Add your first class below!</p>'; 
    return; 
  }
  
  const byDay = {};
  config.schedules.forEach((s, i) => { 
    (byDay[s.dayOfWeek] = byDay[s.dayOfWeek] || []).push({...s, _i: i}); 
  });
  
  let html = '';
  for (let d = 0; d < 7; d++) {
    if (!byDay[d]) continue;
    html += `<div class="day-group"><div class="day-label">${DAYS[d]}</div>`;
    byDay[d].sort((a,b) => a.time.localeCompare(b.time)).forEach(s => {
      const loc = s.location === 'sweat-lab' ? 'üìç Sweat Lab' : 'üìç Fusion Fitness';
      const time12 = formatTime(s.time);
      html += `<div class="card">
        <div class="card-actions">
          <button class="btn-icon" onclick="openModal(${s._i})">‚úèÔ∏è</button>
          <button class="btn-icon btn-delete" onclick="deleteEntry(${s._i})">üóë</button>
        </div>
        <div class="card-top"><span class="class-type">${s.classType}</span><span class="class-time">${time12}</span></div>
        <div class="card-details">
          <span>${loc}</span>
          ${s.instructor ? `<span>üë§ ${s.instructor}</span>` : ''}
          ${s.preferredSpots?.length ? `<span>üí∫ ${s.preferredSpots.join(', ')}</span>` : ''}
        </div>
      </div>`;
    });
    html += '</div>';
  }
  el.innerHTML = html;
}

function formatTime(t) {
  const [h,m] = t.split(':').map(Number);
  const ampm = h >= 12 ? 'PM' : 'AM';
  return `${h%12||12}:${String(m).padStart(2,'0')} ${ampm}`;
}

function openModal(idx) {
  editIndex = idx !== undefined ? idx : -1;
  document.getElementById('modal-title').textContent = editIndex >= 0 ? 'Edit Class' : 'Add Class';
  if (editIndex >= 0) {
    const s = config.schedules[editIndex];
    document.getElementById('f-day').value = s.dayOfWeek;
    document.getElementById('f-time').value = s.time;
    document.getElementById('f-class').value = s.classType;
    document.getElementById('f-location').value = s.location;
    document.getElementById('f-instructor').value = s.instructor || '';
    document.getElementById('f-spots').value = (s.preferredSpots || []).join(', ');
  } else {
    document.getElementById('f-day').value = '1';
    document.getElementById('f-time').value = '09:00';
    document.getElementById('f-class').value = 'SCULPT';
    document.getElementById('f-location').value = 'fusion-fitness';
    document.getElementById('f-instructor').value = '';
    document.getElementById('f-spots').value = '';
  }
  document.getElementById('modal').classList.add('active');
}

function closeModal() { document.getElementById('modal').classList.remove('active'); }

async function saveEntry() {
  const entry = {
    dayOfWeek: parseInt(document.getElementById('f-day').value),
    time: document.getElementById('f-time').value,
    classType: document.getElementById('f-class').value,
    location: document.getElementById('f-location').value,
    preferredSpots: document.getElementById('f-spots').value.split(',').map(s=>s.trim()).filter(Boolean),
  };
  const instr = document.getElementById('f-instructor').value.trim();
  if (instr) entry.instructor = instr;

  if (editIndex >= 0) config.schedules[editIndex] = entry;
  else config.schedules.push(entry);

  await save();
  closeModal();
  render();
}

async function deleteEntry(idx) {
  if (!confirm('Delete this class?')) return;
  config.schedules.splice(idx, 1);
  await save();
  render();
}

async function save() {
  try {
    await fetch('/api/settings', { method: 'PUT', headers: {'Content-Type':'application/json'}, body: JSON.stringify(config) });
    toast('Saved! ‚úì');
  } catch(e) { toast('Save failed ‚úó'); }
}

function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

load();
</script>
</body>
</html>